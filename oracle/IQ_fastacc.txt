~~~~~~~
system:
~~~~~~~
apt-get update -o Acquire::http::No-Cache=True
wajig update
wajig upgrade

wajig install apache2 libcurl4-openssl-dev \
   dpkg-dev build-essential apache2-prefork-dev \
	 libapr1-dev libaprutil1-dev \
   ruby ruby1.8 linux-libc-dev libc6-dev ruby1.8-dev \
   ri1.8 irb1.8 libldap-ruby1.8 libopenssl-ruby libopenssl-ruby1.8 \
   libreadline-ruby1.8 libruby libruby1.8 libyaml-ruby libzlib-ruby -y


~~~~~~~~~~~
user/group:
~~~~~~~~~~~
groupadd -g 124 cclweb
useradd -g 124 -u 124 -d /home/cclweb  -s /bin/bash cclweb
mkdir /home/cclweb
chown cclweb:cclweb /home/cclweb/
passwd cclweb


~~~~
gem:
~~~~
wget http://rubyforge.org/frs/download.php/70696/rubygems-1.3.7.tgz
tar zxvf rubygems-1.3.7.tgz
cd rubygems-1.3.7/
ruby setup.rb
ln -s /usr/bin/gem1.8 /usr/bin/gem
cd ..

gem install actionmailer -v 2.3.8 --no-rdoc --no-ri
gem install actionpack -v 2.3.8 --no-rdoc --no-ri
gem install activerecord -v 2.3.8 --no-rdoc --no-ri
gem install activeresource -v 2.3.8 --no-rdoc --no-ri
gem install activesupport -v 2.3.8 --no-rdoc --no-ri
gem install authlogic -v 2.1.5 --no-rdoc --no-ri
gem install ruby-activeldap -v 0.8.3.1 --no-rdoc --no-ri
gem install ruby-net-ldap -v 0.0.4 --no-rdoc --no-ri
gem install ruby-plsql -v 0.4.3 --no-rdoc --no-ri
gem install json_pure -v 1.4.3 --no-rdoc --no-ri
gem install pg -v 0.9.0 --no-rdoc --no-ri
gem install rack -v 1.1.0 --no-rdoc --no-ri
gem install rails -v 2.3.8 --no-rdoc --no-ri
gem install rake -v 0.8.7 --no-rdoc --no-ri


~~~~~~~~~~~
salesforce:
~~~~~~~~~~~
  501  cd svn/
  503  svn co svn://svn/datawarehouse/trunk/reports/
  511  cd reports/

Copy activerecord-activesalesforce-adapter-2.2.2.gem over:
--gem install activesalesforce -v 1.1.6 --no-rdoc --no-ri
gem install activerecord-activesalesforce-adapter-2.2.2.gem


~~~~~~~
oracle:
~~~~~~~
Copy oracle instant client debian packages over:
  ~/gdrive/it/software/Oracle 10g/instantclient_10.204/x86_64

wajig install ./oracle-instantclient-basic_10.2.0.4-2_amd64.deb \
 oracle-instantclient-devel_10.2.0.4-2_amd64.deb \
 oracle-instantclient-sqlplus_10.2.0.4-2_amd64.deb

/usr/lib/oracle/10.2.0.4/client64/bin/sqlplus dnalims/test22dna@//test22/orcl

gem install ruby-oci8 -v 2.0.4 --no-rdoc --no-ri
gem install activerecord-oracle_enhanced-adapter -v 1.3.0 --no-rdoc --no-ri

cat > /etc/ld.so.conf.d/oracle.conf <<EOF
/usr/lib/oracle/10.2.0.4/client64/lib
EOF

ldconfig

irb
require 'rubygems'
require 'active_record'
db_instance = 'ccllims'
ActiveRecord::Base.establish_connection(:adapter => 'oracle_enhanced',
                                        :database => "//#{db_instance}/orcl",
                                        :username => 'warehouse',
                                        :password => 'dwhreader')



~~~~~~~~~
rails app
~~~~~~~~~
cd svn
svn co svn://svn/clims/tags/ccllims_v3_fastacc_1/src/FastAccession
cd FastAccession/
tar czvf ../FastAccession.tar.gz *
scp FastAccession.tar.gz root@cclweb:/home/cclweb

su - cclweb
tar zxvf FastAccession.tar.gz 

Modify tnsnames.ora
  SID, HOST

Modify config/database.yml
  database, username, password

sqlplus as dnalims - run create_accession_lock.sql
sqlplus as system - run grant_connect.sql
exit

Login as  dnalims on Weban Client:
go to lab set up, add attributes, 'Ready for Review', 'Review Completed', values are "Yes', 'No'. 
go to study set up, associate the 2 attributes with commercial need to script this part
invalidate the accession uniqueness validation rule. will throw an error in interface b/c it never worked. 


~~~~~~~~~~~~~~~~~~
apache + passenger
~~~~~~~~~~~~~~~~~~
gem install passenger --no-rdoc --no-ri
passenger-install-apache2-module

cat > /etc/apache2/mods-available/passenger.conf<<EOF
PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-3.0.1
PassengerRuby /usr/bin/ruby1.8
EOF

cat > /etc/apache2/mods-available/passenger.load<<EOF
LoadModule passenger_module /usr/lib/ruby/gems/1.8/gems/passenger-3.0.1/ext/apache2/mod_passenger.so
EOF

cp /home/cclweb/httpd.conf /etc/apache2

cat > /etc/apache2/sites-available/apache_fastacc.site<<EOF
<VirtualHost *:80>
  ServerName cclweb.cardiodx.com
  Redirect / https://cclweb.cardiodx.com/
</VirtualHost>

<VirtualHost *:443>
  ServerName cclweb.cardiodx.com
  RailsEnv production

  SSLEngine on
  SSLCertificateFile /etc/apache2/ssl/wildcard.cardiodx.com.crt
  SSLCertificateKeyFile /etc/apache2/ssl/wildcard.cardiodx.com.key
  SSLCertificateChainFile /etc/apache2/ssl/gd_bundle.crt

  RequestHeader set X_FORWARDED_PROTO 'https'
  DocumentRoot /home/cclweb/public

  ErrorLog "|/usr/bin/logger -p local0.err"
  LogFormat "%h %l %u %t \"%r\" %>s %b" privacy_format
  CustomLog "|/usr/bin/logger -p local1.info" privacy_format
</VirtualHost>
EOF

cd /etc/apache2
mkdir ssl
cd ssl


vi /usr/local/bin/ruby_with_env
export ORACLE_HOME=/home/cclweb
export TNS_ADMIN=/home/cclweb
export LD_LIBRARY_PATH=/usr/lib/oracle/10.2.0.4/client64/lib:$LD_LIBRARY_PATH
export NLS_LANG="AMERICAN_AMERICA.UTF8"
/usr/bin/ruby $*

chmod 755 /usr/local/bin/ruby_with_env


copy the following files over from PDC:
  - wildcard.cardiodx.com.crt
  - wildcard.cardiodx.com.key
  - gd_intermediate_bundle.crt

chmod 660 wildcard.cardiodx.com.key


a2enmod passenger
a2enmod ssl
a2enmod headers
a2dissite default
a2ensite apache_fastacc.site
/etc/init.d/apache2 restart

https://cclweb.cardiodx.com




