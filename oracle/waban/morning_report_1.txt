set pagesize 1000
set linesize 350

--
-- # of samples
--
select count(distinct a.accession_number) sample_count
from sample_table s, accession a
where a.accession_id = s.accession_id
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial');

--
-- # of boxes
--
select count(distinct s.value) box
from protocol_defined_variable pdv, sample_variable_fld_tbl s, variable v
where pdv.protocol_defined_variable_id = s.protocol_defined_variable_id
and pdv.variable_id = v.variable_id
and variable_name = 'Nanocool Barcode'
and s.sample_id in 
		(select sample_id
		from sample_table s, accession a
		where a.accession_id = s.accession_id
		and to_char(a.date_received) = '12-AUG-11'
		and source_type = 'Blood'
		and study_protocol_id in
   			(select study_protocol_id
    		from study_protocol
    		where study_title = 'Commercial')
		);

--
-- multi pack
--
col nanocool for a20
select sv.value "Nanocool", count(distinct a.accession_number) count
from sample_table s, accession a,
  protocol_defined_variable pdv, sample_variable_fld_tbl sv, variable v
where a.accession_id = s.accession_id
   and pdv.protocol_defined_variable_id = sv.protocol_defined_variable_id
   and pdv.variable_id = v.variable_id
   and sv.sample_id = s.sample_id
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and a.study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial')
and variable_name = 'Nanocool Barcode'
group by value
having count(distinct a.accession_number) > 1
order by count desc;

--
-- comments
--
col comments for a45
select a.accession_number, comments, sample_id
from sample_table s, accession a, user_comments c
where a.accession_id = s.accession_id
   and s.sample_id = c.screen_pk
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial')
order by a.accession_number;

--
-- sample condition
--
select sample_condition, count(*)
from sample_table s, accession a
where a.accession_id = s.accession_id
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial')
group by sample_condition;

select distinct a.accession_number, sample_tube_id, sample_id, sample_condition
from sample_table s, accession a
where a.accession_id = s.accession_id
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and sample_condition <> 'Acceptable'
and study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial')
order by sample_condition;

select distinct a.accession_number, sample_tube_id, sample_id, sample_condition, comments
from sample_table s, accession a, user_comments c
where a.accession_id = s.accession_id
   and s.sample_id = c.screen_pk
and to_char(a.date_received) = '12-AUG-11'
and source_type = 'Blood'
and study_protocol_id in
   (select study_protocol_id
    from study_protocol
    where study_title = 'Commercial')
order by sample_tube_id, sample_condition;


