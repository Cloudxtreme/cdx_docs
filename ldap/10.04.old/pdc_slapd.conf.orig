include         /etc/ldap/schema/core.schema
include         /etc/ldap/schema/cosine.schema
include         /etc/ldap/schema/nis.schema
include         /etc/ldap/schema/inetorgperson.schema
include         /etc/ldap/schema/samba.schema
include         /etc/ldap/schema/misc.schema

modulepath      /usr/lib/ldap
moduleload      back_bdb

allow bind_v2

pidfile /var/run/slapd.pid

database bdb
suffix "dc=cardiodx,dc=com"
rootdn "cn=Manager,dc=cardiodx,dc=com"
#rootpw {SSHA}pykT3hkPv9JrAUTcRAlxntjvP1lazXHY
rootpw {SSHA}pykT3hkPv9JrAUTcRAlxntjvP1lazXHY

directory /data/ldap
loglevel 512
# To allow TLS-enabled connections, create /etc/ssl/openldap/ldap.pem
# and uncomment the following lines.
TLSCertificateFile      /etc/ldap/wildcard.cardiodx.com.crt
TLSCertificateKeyFile   /etc/ldap/wildcard.cardiodx.com.key
#TLSCACertificateFile    /etc/ldap/gd_intermediate_bundle.crt
TLSCACertificateFile    /etc/ldap/gd_bundle.crt
# If ciphersuite is not set to high -- smbldap has issues connecting
TLSCipherSuite HIGH

# Enforces TLS connections for authentication as well as updates
security update_ssf=128 simple_bind=128
#security ssf=0

index objectClass eq
index cn pres,sub,eq
index sn pres,sub,eq
index uid pres,sub,eq
index displayName pres,sub,eq
index uidNumber eq
index gidNumber eq
index memberUID eq
index sambaSID eq
index sambaPrimaryGroupSID eq
index sambaDomainName eq
index default sub

#access to dn.subtree="ou=Users,dc=cardiodx,dc=com" attrs=entry,mailLocalAddress,mailRoutingAddress,mail
#        by * read
#
# users can authenticate and change their password
access to attrs=userPassword,sambaNTPassword,sambaLMPassword,sambaPwdLastSet,sambaPwdMustChange
      by self write
      by anonymous auth
      by * none
## some attributes need to be readable anonymously so that 'id user' can answer correctly
#access to attrs=objectClass,entry,gecos,homeDirectory,uid,uidNumber,gidNumber,cn,memberUid,sn
#      by * read
#
#access to dn.subtree="ou=Users,dc=cardiodx,dc=com" 
access to *
        by * read

