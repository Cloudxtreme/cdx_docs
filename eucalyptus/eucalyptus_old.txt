ubuntu cloud computing

https://help.ubuntu.com/community/Eucalyptus
http://open.eucalyptus.com/wiki/EucalyptusInstall_v1.5.2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   23  wajig install openssh-server -y
   30  wajig install vim-nox
   31  wajig install sysv-rc-conf
   32  wajig install lvm2 xfsprogs
   33  wajig install ntp
   55  wajig install ganglia-monitor

   97  wajig install build-essential fakeroot deborphan subversion 
   99  wajig install sun-java6-jdk -y
  100  wajig install libpam-ldap libnss-ldap -y

  101  wajig install eucalyptus-cloud eucalyptus-cc

  104  wajig install kvm libvirt-bin ubuntu-vm-builder
  105  wajig install ca-certificates
  106  wajig install python-virtinst
  107  wajig install virt-viewer
  108  wajig install xterm xauth
  111  wajig install eucalyptus-nc
  118  wajig install uml-utilities

  112  wajig install smbfs
  113  wajig install wireshark
  114  wajig install winbind samba

  115  :wajig install ruby rdoc irb libyaml-ruby libzlib-ruby ri libopenssl-ruby 
  116  wajig install ruby rdoc irb libyaml-ruby libzlib-ruby ri libopenssl-ruby 
  117  wajig install ruby1.8-dev libldap-ruby1.8 -y
  133  wajig install curl


on cluster+cloud:
wajig install eucalyptus-cloud eucalyptus-cc

on node:
wajig install eucalyptus-nc


-- on node, configure bridge interface
# cd /etc/network
# vi interfaces
auto eth0
iface eth0 inet dhcp

auto br0
iface br0 inet dhcp
        bridge_ports eth0
        bridge_fd 9
        bridge_hello 2
        bridge_maxage 12
        bridge_stp off

# /etc/init.d/networking restart

# /etc/init.d/eucalyptus-nc stop
# cd /etc/eucalyptus
# vi eucalyptus.conf
VNET_INTERFACE="br0"
VNET_BRIDGE="br0"
# /etc/init.d/eucalyptus-nc start


-- on both:
# vi /etc/sysctl.conf 
net.ipv4.ip_forward=1

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  147  /etc/init.d/eucalyptus-cloud restart
  148  /etc/init.d/eucalyptus-cc restart

  150  euca_conf -addcluster testcluster localhost
New cluster 'localhost' on host 'localhost' successfully added.

euca_conf -addnode ubuntu904

-- on node:
sudo tee ~eucalyptus/.ssh/authorized_keys > /dev/null <<EOT
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAt4N+1Cj6jBwjq/yKvnABQf38iJDdOwIB53ypFZrdWVMoRNUjF94WqvtjWRiIEj0yKtZQu+w/arF66tryu14xYaKpXhpfWtutpdpqERL2cyXK/YUkUuj0PtyddzXeyAdTqcTfiwwhw5QdONSMOJVepjdE7wd+G+4OOyCZ//O02llBSGRL45PR4JnywsGWGli5+qX8NixMLydNuYfJKYisH8g2ZBE7hbdJfj+i9nUCBDKVXu+MeZ9aQeI5/R14yq1yOc2N0oHwzc4Ld6wEE0y2X1klU5XtMjCDo+IFe+qo0O2610P7MlaeRvdLUbQRcaXpQWvTLPwKnl7A4wCI/w4dlw== eucalyptus@ubuntu904
EOT

-- on cluster
(hit return)

SUCCESS: added node 'ubuntu904' to '/etc/eucalyptus/eucalyptus.conf'


https://ubuntu904:8443
(change admin pwrd)
(enter admin email address)
Walrus url: http://ubuntu904:8773/services/Walrus

Click: credentials tab
Click Download Certificate


(Not done, yet) 
Click Register
On firewall, open:
67.95.201.194:8443 to ubuntu904

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

mkdir eucalyptus
cd eucalyptus
wget http://s3.amazonaws.com/ec2-downloads/ec2-api-tools-1.3-30349.zip
wget http://s3.amazonaws.com/ec2-downloads/ec2-ami-tools-1.3-26357.zip 

unzip ec2-api-tools-1.3-30349.zip
unzip ec2-ami-tools-1.3-26357.zip


mkdir .euca
cd .euca
  349  mkdir bin etc lib
  350  cp -rp /root/eucalyptus/ec2-ami-tools-1.3-26357/bin/* bin/
  351  cp -rp /root/eucalyptus/ec2-ami-tools-1.3-26357/etc/* etc/
  352  cp -rp /root/eucalyptus/ec2-ami-tools-1.3-26357/lib/* lib/
  362  cp -rp /root/eucalyptus/ec2-api-tools-1.3-30349/bin/* bin
  363  cp -rp /root/eucalyptus/ec2-api-tools-1.3-30349/lib/* lib/

scp euca2-admin-x509.zip to server and unzip it

. eucarc 
export JAVA_HOME=/usr/lib/jvm/java-6-sun
export EC2_HOME=~/.euca
export PATH=$PATH:$EC2_HOME/bin

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

--
-- xen
--
vi part
root 400
/mnt/ephemeral 0 /dev/sda2 
swap 1 /dev/sda3

vi firstboot
apt-get -y install openssh-server 

vmbuilder xen ubuntu --part ./part --firstboot ./firstboot
ls -al ubuntu-xen

--
-- kvm
--
vi part
root 400
swap 200 

vmbuilder kvm ubuntu -v --part ./part --firstboot ./firstboot
ls -al ubuntu-kvm


--
-- https://help.ubuntu.com/community/JeOSVMBuilder
--
vmbuilder kvm ubuntu \
		--suite jaunty \
		--verbose \
		--flavour virtual \
		--arch amd64 \
    --user cardiodx \
    --pass internalpwd \
    --hostname hardy1 \
    --mem 256 \
		--addpkg openssh-server \
		--libvirt qemu:///system

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~`

ec2-describe-availability-zones verbose

uname -a

mkdir kernel
ec2-bundle-image -i /boot/vmlinuz-2.6.28-14-server -d ./kernel --kernel true
ec2-upload-bundle -b kernel -m ./kernel/vmlinuz-2.6.28-14-server.manifest.xml
EKI=`ec2-register kernel/vmlinuz-2.6.28-14-server.manifest.xml | awk '{print $2}'`
echo $EKI

mkdir ramdisk
ec2-bundle-image -i /boot/initrd.img-2.6.28-14-server -d ./ramdisk --ramdisk true
ec2-upload-bundle -b ramdisk -m ramdisk/initrd.img-2.6.28-14-server.manifest.xml
ERI=`ec2-register ramdisk/initrd.img-2.6.28-14-server.manifest.xml | awk '{print $2}'`
echo $ERI

mkdir image
ec2-bundle-image -i ubuntu-kvm/disk0.qcow2 -d ./image --kernel $EKI --ramdisk $ERI
ec2-upload-bundle -b image -m ./image/disk0.qcow2.manifest.xml
EMI=`ec2-register image/disk0.qcow2.manifest.xml | awk '{print $2}'`
echo $EMI


ec2-describe-images
-- ec2-deregister emi-29A90CFF

--
-- start the instance
--
  536  ec2-add-keypair mykey > ~/.euca/mykey.priv
  539  chmod 0600 ~/.euca/mykey.priv

  538  ec2-describe-keypairs 

  540  ec2-run-instances $EMI -k mykey
  541  watch ec2-describe-instances


/var/lib/eucalyptus/instances/admin/i-3E8107E9


~~~~~~~~~~~~~~~~~~~~
  601  ec2-describe-images
  612  ec2-bundle-image -i ubuntu-kvm/disk0.qcow2 -d ./image/ --kernel eki-3479121D --ramdisk eri-85831368
  613  ec2-upload-bundle -b ubuntu1 -m ./image/disk0.qcow2.manifest.xml 
  614  ec2-register image/disk0.qcow2.manifest.xml 
  624  ec2-run-instances emi-4DDC0DB7 -k mykey
  625  ec2-describe-instances 

ec2-get-console-output i-4AD408EE

  ????
  629  ssh -i ~/.euca/mykey.priv root@10.10.35.21
  Couldn't login!!    
		---> ssh: connect to host 10.10.35.21 port 22: No route to host
    
ec2-terminate-instances i-2E1705B2
virsh start hardy1
  --> Run ifconfig ---> IP=192.168.122.7

vi /etc/libvirt/qemu/hardy1.xml
  Change the following two lines:
		    <interface type='bridge'>
				<source bridge='br0'/>

shutdown hardy1

virsh to redefine hardy1

start hardy1


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
?????
download s3cmd from: http://sourceforge.net/projects/s3tools/files/s3cmd/#files
tar zxvf s3cmd-0.9.9-rc3.tar.gz
python setup.py install
s3cmd --configure






