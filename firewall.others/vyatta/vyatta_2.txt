boot from install cd (vc 5.02)
  login as vyatta/vyatta
install-system
  8192MB
reboot

vi /boot/grub/grub.cfg
set default=1
set timeout=3

>>>> NOTE:
  Can't use update-grup!!!
  Take about 2 minutes to reboot.

picocom -b 9600 /dev/ttyS0
  ^a ^x (quit)


eth0 --> eth1 ... internal 10.10.37.3/21
eth1 --> eth8
eth2 --> eth2 ... AT&T  12.238.241.98/28
eth3 --> eth3 ... XO

eth4 --> eth4 ... dmz   192.168.17.1/24
eth5 --> eth5 ... guest 192.168.19.1/24
eth6 --> eth6 ... lab
eth7 --> eth7 ... IT


root@vyatta:~# configure
root@vyatta# set interfaces ethernet eth1 address 10.10.37.3/21
root@vyatta# set service ssh
root@vyatta# commit

ccmac:~ cchou$ ssh vyatta@10.10.37.3


configure
set interfaces ethernet eth2 address 12.238.241.98/28
set system host-name vyatta
set system gateway-address 12.238.241.97
set system domain-name cardiodx.com
set system name-server 10.10.37.21
set system ntp-server 91.189.94.4
set system time-zone US/Pacific
commit
save
   Saving configuration to '/opt/vyatta/etc/config/config.boot'...
exit


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
NOTE:
  1) As it is shipped the Vyatta System does not restrict traffic flow through it.
     That is, unless a firewall rule is applied to an interface it will allow all traffic through it.
  2) When applying a firewall rule set, keep in mind that after the final user-defined rule,
     an implicit rule of deny all takes effect.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


set firewall name to_vyatta
set firewall name to_vyatta rule 10
set firewall name to_vyatta rule 10 action accept
set firewall name to_vyatta rule 10 state established enable

set firewall name to_vyatta
set firewall name to_vyatta rule 11
set firewall name to_vyatta rule 11 action accept
set firewall name to_vyatta rule 11 protocol icmp
set firewall name to_vyatta rule 11 limit rate 2/second
set firewall name to_vyatta rule 11 limit burst 5

set firewall name to_vyatta
set firewall name to_vyatta rule 20
set firewall name to_vyatta rule 20 action accept
set firewall name to_vyatta rule 20 protocol all
set firewall name to_vyatta rule 20 source address 10.10.32.0/21

set interfaces ethernet eth2 firewall local name to_vyatta
set interfaces ethernet eth2 firewall in name to_vyatta

-- from cdx
set service nat rule 10
set service nat rule 10 outbound-interface eth2
set service nat rule 10 source address 10.10.32.0/21
set service nat rule 10 type masquerade

set firewall name from_cdx
set firewall name from_cdx rule 10
set firewall name from_cdx rule 10 action accept
set firewall name from_cdx rule 10 log disable
set firewall name from_cdx rule 10 source address 10.10.32.0/21
set firewall name from_cdx rule 10 destination address 0.0.0.0/0

set interfaces ethernet eth1 firewall in name from_cdx

commit
save

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-- pat
set service nat rule 510
set service nat rule 510 type destination
set service nat rule 510 protocol tcp
set service nat rule 510 inbound-interface eth2
set service nat rule 510 destination address 173.13.158.185
set service nat rule 510 destination port 80
set service nat rule 510 inside-address address 10.10.35.30

-- add a new firewall rule
set firewall name to_cdx
set firewall name to_cdx rule 10
set firewall name to_cdx rule 10 action accept
set firewall name to_cdx rule 10 state established enable
set firewall name to_cdx rule 10 destination address 10.10.32.0/21

set firewall name to_cdx
set firewall name to_cdx rule 11
set firewall name to_cdx rule 11 action accept
set firewall name to_cdx rule 11 protocol icmp
set firewall name to_cdx rule 11 limit rate 2/second
set firewall name to_cdx rule 11 limit burst 5
set firewall name to_cdx rule 11 destination address 10.10.32.0/21

set firewall name to_cdx rule 20
set firewall name to_cdx rule 20 protocol tcp
set firewall name to_cdx rule 20 action accept
set firewall name to_cdx rule 20 log disable
set firewall name to_cdx rule 20 source address 0.0.0.0/0
set firewall name to_cdx rule 20 destination address 10.10.35.30
set firewall name to_cdx rule 20 destination port 80

set interfaces ethernet eth1 firewall out name to_cdx

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
--dmz
set interfaces ethernet eth4 address 192.168.17.1/24
set interfaces ethernet eth2 address 12.238.241.99/28

set service nat rule 310 type source
set service nat rule 310 protocol all
set service nat rule 310 source address 192.168.17.2
set service nat rule 310 destination address 0.0.0.0/0
set service nat rule 310 outbound-interface eth2
set service nat rule 310 outside-address address 12.238.241.99

set service nat rule 311 type destination
set service nat rule 311 protocol all
set service nat rule 311 source address 0.0.0.0/0
set service nat rule 311 inbound-interface eth2
set service nat rule 311 destination address 12.238.241.99
set service nat rule 311 inside-address address 192.168.17.2

-- dmz_all
set firewall name from_dmz rule 10
set firewall name from_dmz rule 10 action accept
set firewall name from_dmz rule 10 state established enable
set firewall name from_dmz rule 10 source address 192.168.17.0/24

set firewall name from_dmz
set firewall name from_dmz rule 11
set firewall name from_dmz rule 11 action accept
set firewall name from_dmz rule 11 protocol icmp
set firewall name from_dmz rule 11 limit rate 2/second
set firewall name from_dmz rule 11 limit burst 5
set firewall name from_dmz rule 11 source address 192.168.17.0/24

-- dmz_out
set firewall name from_dmz
set firewall name from_dmz
set firewall name from_dmz rule 30 action accept
set firewall name from_dmz rule 30 protocol tcp
set firewall name from_dmz rule 30 destination port 25,80
set firewall name from_dmz rule 30 source address 192.168.17.0/24
set firewall name from_dmz rule 30 destination address 0.0.0.0/0
set firewall name from_dmz rule 30 log disable

set firewall name from_dmz
set firewall name from_dmz rule 40 action accept
set firewall name from_dmz rule 40 protocol udp
set firewall name from_dmz rule 40 destination port 53,123
set firewall name from_dmz rule 40 source address 192.168.17.0/24
set firewall name from_dmz rule 40 destination address 0.0.0.0/0
set firewall name from_dmz rule 40 log disable

-dmz_in (basics)
set firewall name from_dmz
set firewall name from_dmz rule 50 action accept
set firewall name from_dmz rule 50 protocol tcp
set firewall name from_dmz rule 50 destination port 389
set firewall name from_dmz rule 50 source address 192.168.17.0/24
set firewall name from_dmz rule 50 destination address 10.10.37.21
set firewall name from_dmz rule 50 log disable

set firewall name from_dmz
set firewall name from_dmz rule 60 action accept
set firewall name from_dmz rule 60 protocol udp
set firewall name from_dmz rule 60 destination port 53
set firewall name from_dmz rule 60 source address 192.168.17.0/24
set firewall name from_dmz rule 60 destination address 10.10.37.21
set firewall name from_dmz rule 60 log disable

set firewall name from_dmz
set firewall name from_dmz rule 70 action accept
set firewall name from_dmz rule 70 protocol udp
set firewall name from_dmz rule 70 destination port 514
set firewall name from_dmz rule 70 source address 192.168.17.0/24
set firewall name from_dmz rule 70 destination address 10.10.37.25
set firewall name from_dmz rule 70 log disable

set firewall name to_cdx
set firewall name to_cdx rule 12 action accept
set firewall name to_cdx rule 12 protocol tcp
set firewall name to_cdx rule 12 destination port 389
set firewall name to_cdx rule 12 source address 192.168.17.0/24
set firewall name to_cdx rule 12 destination address 10.10.37.21
set firewall name to_cdx rule 12 log disable

set firewall name to_cdx
set firewall name to_cdx rule 13 action accept
set firewall name to_cdx rule 13 protocol udp
set firewall name to_cdx rule 13 destination port 53
set firewall name to_cdx rule 13 source address 192.168.17.0/24
set firewall name to_cdx rule 13 destination address 10.10.37.21
set firewall name to_cdx rule 13 log disable

set firewall name to_cdx
set firewall name to_cdx rule 14 action accept
set firewall name to_cdx rule 14 protocol udp
set firewall name to_cdx rule 14 destination port 514
set firewall name to_cdx rule 14 source address 192.168.17.0/24
set firewall name to_cdx rule 14 destination address 10.10.37.25
set firewall name to_cdx rule 14 log disable


set firewall name to_dmz
set firewall name to_dmz rule 10
set firewall name to_dmz rule 10 action accept
set firewall name to_dmz rule 10 state established enable
set firewall name to_dmz rule 10 destination address 192.168.17.0/24

set firewall name to_dmz
set firewall name to_dmz rule 11 
set firewall name to_dmz rule 11 action accept
set firewall name to_dmz rule 11 protocol icmp
set firewall name to_dmz rule 11 limit rate 2/second
set firewall name to_dmz rule 11 limit burst 5
set firewall name to_dmz rule 11 destination address 192.168.17.0/24

set firewall name to_dmz
set firewall name to_dmz rule 12
set firewall name to_dmz rule 12 action accept
set firewall name to_dmz rule 12 protocol all
set firewall name to_dmz rule 12 source address 10.10.32.0/21
set firewall name to_dmz rule 12 destination address 192.168.17.0/24

set firewall name to_dmz
set firewall name to_dmz rule 20
set firewall name to_dmz rule 20 protocol tcp
set firewall name to_dmz rule 20 action accept
set firewall name to_dmz rule 20 log disable
set firewall name to_dmz rule 20 source address 0.0.0.0/0
set firewall name to_dmz rule 20 destination address 192.168.17.2
set firewall name to_dmz rule 20 destination port 80

set interfaces ethernet eth4 firewall out name to_dmz
set interfaces ethernet eth4 firewall in name from_dmz

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

set interfaces ethernet eth5 address 192.168.19.1/24

set firewall name to_guest
set firewall name to_guest rule 10
set firewall name to_guest rule 10 action accept
set firewall name to_guest rule 10 state established enable
set firewall name to_guest rule 10 destination address 192.168.19.0/24

set firewall name from_guest
set firewall name from_guest rule 10
set firewall name from_guest rule 10 action accept
set firewall name from_guest rule 10 log disable
set firewall name from_guest rule 10 source address 192.168.19.0/24
set firewall name from_guest rule 10 destination address 0.0.0.0/0

-- no ping is allowed

set interfaces ethernet eth5 firewall out name to_guest
set interfaces ethernet eth5 firewall in name from_guest




